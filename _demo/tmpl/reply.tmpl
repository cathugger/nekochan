{{/*

single reply to thread

arguments list:
	*root_data
	*IBCommonThread
	*IBPostInfo
	FullURLs
	MaxLines
	MaxCharsPerLine

*/ -}}

{{$X := index $ 0 -}}
{{$T := index $ 1 -}}
{{$P := index $ 2 -}}
{{$fullURLs := index $ 3 -}}
{{$maxLines := index $ 4 -}}
{{$maxCPL   := index $ 5 -}}

{{with $P -}}
 <div class="reply">

  <p class="rinfo" id="p{{$P.ID}}">
   {{- if $P.Subject -}}
    <span class="subject">{{html $P.Subject}}</span>
   {{- end}}

   <span class="name">{{html $P.Name}}</span>

   {{- if $P.Trip}}<span class="trip">{{html $P.Trip}}</span>{{end}}

   <time
    class="pdate"
    datetime="{{dateISO $P.Date}}"
    title="{{dateAlt $P.Date}}"
   >{{date $P.Date}}</time>

   <a
    href="{{if $fullURLs}}thread/{{$T.ID}}{{end}}#p{{$P.ID}}"
   >No.</a> {{$P.ID}}
   {{- range .BackReferences}}
    <a class="opref" href="#p{{.}}">&gt;&gt;{{.}}</a>
   {{- end}}

  </p>

  {{- range .Files}}
   <div class="rimg">

    <p class="imginfo">File:
     <a
      class="filelink"
      title="{{html .Original}}"
      href="{{$X.N.FRoot}}/_src/{{urlpath .ID}}/{{urlpath .Original}}"
     >{{html (truncatefn .Original 24)}}</a>

     {{/* TODO: should print more info about file */ -}}
     (<span title="{{.Size}} bytes">{{filesize .Size}}</span>)
    </p>

    <a class="imglink" href="{{$X.N.FRoot}}/_src/{{urlpath .ID}}">
     {{- if .Thumb.ID -}}
      <img class="imgthumb" src="{{$X.N.FRoot}}/_thm/{{urlpath .Thumb.ID}}" width="{{.Thumb.Width}}" height="{{.Thumb.Height}}" />
     {{- else -}}
      <img class="imgthumb" src="{{$X.N.Root}}/_static/{{urlpath .Thumb.Alt}}" width="{{.Thumb.Width}}" height="{{.Thumb.Height}}" />
     {{- end -}}
    </a>

   </div>
  {{- end}}

  {{- if gt (len $P.Files) 1}}<div style="clear:both"></div>{{end}}

  {{- fmtmsg $X.R $X.N $X.D.Board $T $P $maxLines $maxCPL}}
  <div style="clear:both"></div>
 </div>
{{end -}}
