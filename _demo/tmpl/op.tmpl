{{/*

OP

arguments list:
	*root_data
	*IBCommonThread
	*IBPostInfo
	FullURLs
	MaxLines
	MaxCharsPerLine

*/ -}}

{{$X := index $ 0 -}}
{{$T := index $ 1 -}}
{{$P := index $ 2 -}}
{{$fullURLs := index $ 3 -}}
{{$maxLines := index $ 4 -}}
{{$maxCPL   := index $ 5 -}}

{{with $P -}}
 <p class="opinfo" id="p{{$P.ID}}">
  {{- if $P.Subject -}}
   <span class="subject">{{html $P.Subject}}</span>
  {{- end}}

  <span class="name">{{html (anonname $P.Name)}}</span>

  {{- if $P.Trip}}<span class="trip">{{html $P.Trip}}</span>{{end}}

  <time
   class="pdate"
   datetime="{{dateISO $P.Date}}"
   title="{{dateAlt $P.Date}}"
  >{{date $P.Date}}</time>

  <a
   href="{{if $fullURLs}}thread/{{$T.ID}}{{end}}#p{{$P.ID}}"
  >No.</a> <span>{{$P.ID}}</span>

  {{- if $fullURLs}} <span>[<a href="thread/{{$T.ID}}">Reply</a>]</span>{{end}}

  {{- range $P.BackReferences}}
   <a class="opref" href="#p{{.}}">&gt;&gt;{{.}}</a>
  {{- end}}
 </p>

 {{- range $P.Files}}
  <div class="opimg">
   <p class="imginfo">File:
    <a
     class="filelink"
     title="{{html .Original}}"
     href="{{$X.N.FRoot}}/_src/{{urlpath .ID}}/{{urlpath .Original}}"
    >
     {{- html (truncatefn .Original 24) -}}
    </a>

    {{/* TODO: should print more info about file */ -}}
    (<span title="{{.Size}} bytes">{{filesize .Size}}</span>)
   </p>

   <a class="imglink" href="{{$X.N.FRoot}}/_src/{{urlpath .ID}}">
    {{- if .Thumb.ID -}}
     <img
      class="imgthumb"
      src="{{$X.N.FRoot}}/_thm/{{urlpath .Thumb.ID}}"
      {{- if .Thumb.Width}} width="{{.Thumb.Width}}"{{end}}
      {{- if .Thumb.Height}} height="{{.Thumb.Height}}"{{end}}
     />
    {{- else if .Thumb.Alt -}}
     <img
      class="imgthumb"
      src="{{$X.N.Root}}/_static/{{urlpath .Thumb.Alt}}"
      {{- if .Thumb.Width}} width="{{.Thumb.Width}}"{{end}}
      {{- if .Thumb.Height}} height="{{.Thumb.Height}}"{{end}}
     />
    {{- else -}}
     {{.ID}}
    {{- end -}}
   </a>
  </div>
 {{- end}}

 {{- if gt (len $P.Files) 1}}<div style="clear:both"></div>{{end}}

 {{- fmtmsg $X.R $X.N $X.D.Board $T $P $maxLines $maxCPL}}
{{end -}}
